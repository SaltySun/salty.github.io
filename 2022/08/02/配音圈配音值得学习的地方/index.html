<!DOCTYPE html><html lang="zh-cn" theme-mode="dark"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>配音圈配音 | Dr.SlatySun</title><script>var config = {"root":"/salty.github.io/","search":{"preload":false,"activeHolder":"键入以继续","blurHolder":"数据检索","noResult":"无 $0 相关数据"},"code":{"codeInfo":"$0 - 共 $1 行","copy":"复制","copyFinish":"复制成功","expand":"展开"}}</script><script src="//unpkg.com/mermaid@9.2.2/dist/mermaid.min.js"></script><link rel="stylesheet" href="/salty.github.io/css/arknights.css"><script>if (window.localStorage.getItem('theme-mode') === 'light') document.documentElement.setAttribute('theme-mode', 'light')
if (window.localStorage.getItem('theme-mode') === 'dark') document.documentElement.setAttribute('theme-mode', 'dark')</script><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/salty.github.io/font/BenderLight.ttf");
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/salty.github.io/font/JetBrainsMono-Regular.woff2') format('woff2');
}</style><meta name="referrer" content="no-referrer"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/salty.github.io/atom.xml" title="Dr.SlatySun" type="application/atom+xml">
</head><body><div class="loading" style="opacity: 0"><div class="loadingBar left"></div><div class="loadingBar right"></div></div><main><header class="closed"><nav><div class="navBtn hide"><i class="navBtnIcon"><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span><span class="navBtnIconBar"></span></i></div><div class="navItem" id="search-header"><span class="navItemTitle"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="数据检索" spellcheck="false" maxlength="50" type="text" id="search-input"></span></div><div class="navItem" id="search-holder"></div><div class="search-popup"><div id="search-result"></div></div><ol class="navContent"><li class="navItem"><a class="navBlock" href="/salty.github.io/"><span class="navItemTitle">Home</span></a></li><li class="navItem" matchdata="categories,tags"><a class="navBlock" href="/salty.github.io/archives/"><span class="navItemTitle">Archives</span></a></li></ol></nav></header><article><div id="post-bg"><div id="post-title"><h1>配音圈配音</h1><div id="post-info"><span>文章发布时间: <div class="control"><time datetime="2022-08-01T16:00:00.000Z" id="date"> 2022-08-02</time></div></span><br><span>最后更新时间: <div class="control"><time datetime="2023-03-24T06:52:24.693Z" id="updated"> 2023-03-24</time></div></span></div></div><hr><div id="post-content"><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="配音圈配音的模块化"><a href="#配音圈配音的模块化" class="headerlink" title="配音圈配音的模块化"></a>配音圈配音的模块化</h2><p>ES6的Class 类<br>    在传统的<code>js</code>语法当中，如果我们想创建一个实例对象的时候一般会先定义一个构造函数，然后通过<code>new</code>运算符来创建一个实例对象，例如: </p>
<ul>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name,age</span>)&#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age<br>&#125;<br><span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">showName</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>)<br>&#125;<br><span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">showAge</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span>)<br>&#125;<br><span class="hljs-keyword">var</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;xz&#x27;</span>,<span class="hljs-number">21</span>)<br>person.<span class="hljs-title function_">showName</span>()<span class="hljs-comment">//&#x27;xz&#x27;</span><br>person.<span class="hljs-title function_">showAge</span>()<span class="hljs-comment">//21</span><br></code></pre></td></tr></table></figure></li>
</ul>
<p>我们定义一个<code>Person</code>的构造函数，然后通过<code>new Person()</code>来创建一个实例对象。一般我们向构造函数的原型上添加方法，表示实例要继承的方法，这个方法是公共的，不是某个实例自己特有的方法。这样我们就可以完成一个具体的实例了。<br>而在<code>ES6</code>中，为我们提供了一个叫<code>Class</code>的一个方法,让我们能够更容易理解和创建一个实例对象。例如： </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name,age</span>)&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age<br>    &#125;<br>    <span class="hljs-title function_">showName</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-comment">//为我们的实例添加继承的方法</span><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>)<br>    &#125;<br>    <span class="hljs-title function_">showAge</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-comment">//为我们的实例添加继承的方法</span><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span>)<br>    &#125;<br>&#125;<br><span class="hljs-keyword">var</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">&#x27;xz&#x27;</span>,<span class="hljs-number">21</span>)<br>	person.<span class="hljs-title function_">showName</span>()<span class="hljs-comment">//&#x27;xz&#x27;</span><br>	person.<span class="hljs-title function_">showAge</span>()<span class="hljs-comment">//21</span><br></code></pre></td></tr></table></figure>

<p>注意： </p>
<pre><code>     -  如果使用es6的class类语法要注意一点就是 `constructor`方法是类默认方法，通过`new`命令生成对象实例时自动调用该方法。一个类必须有一个`constructor`方法，如果没有显示定义，那么一个空的`constructor`方法会被默认添加。 
     -  类的声明不存在变量提升 
</code></pre>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>()<span class="hljs-comment">//报错，因为类的声明不存在变量提升</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>&#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;xz&#x27;</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = <span class="hljs-number">21</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>js类的继承<br>根据ES6的语法，super关键字，extends来进行类的继承操作<br>我们可以通过<code>extends</code>关键字来实现子类对父类的继承。子类必须在<code>constructor</code>方法中调用<code>super</code>方法，否则新建的实例会报错。原因在于子类没有自己的<code>this</code>对象，而是继承父类的<code>this</code>对象，然后进行加工，如果不调用<code>super</code>关键字，那么子类就拿不到<code>this</code>对象，而<code>super</code>在其中表示的其实是父类的构造函数 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">sup</span>&#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>)&#123;&#125;<br>    <span class="hljs-title function_">show</span>(<span class="hljs-params"></span>)&#123;<span class="hljs-comment">//向父类的原型上挂载show()方法</span><br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;sup&#x27;</span>)<br>    &#125;<br>&#125;<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">sub</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">sup</span>&#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-variable language_">super</span>()<br>    &#125;<br>    <span class="hljs-title function_">showinfo</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">super</span>.<span class="hljs-title function_">show</span>())<br>    &#125;<br>&#125;<br><span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title function_">sub</span>()<br>obj.<span class="hljs-title function_">showinfo</span>()<span class="hljs-comment">//sup</span><br></code></pre></td></tr></table></figure>
<p>配音圈配音的utils里有6个文件,模块化的大致思路是一样的。举例： </p>
<ul>
<li><p>config.js </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>&#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>)&#123;<br><br>    &#125;<br>&#125;<br><span class="hljs-title class_">Config</span>.<span class="hljs-property">restUrl</span> = <span class="hljs-string">&#x27;https://dub.wuhanzhuangxiu01.cn&#x27;</span>;<br><span class="hljs-title class_">Config</span>.<span class="hljs-property">onPay</span> = <span class="hljs-literal">true</span>;  <span class="hljs-comment">//是否启用支付</span><br>........<br><br><span class="hljs-keyword">export</span> &#123;<span class="hljs-title class_">Config</span>&#125;;<br></code></pre></td></tr></table></figure>

</li>
<li><p>base.js </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> *  自定义基类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> &#123;<br>  <span class="hljs-title class_">Config</span><br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./config.js&#x27;</span>;<br><br><span class="hljs-keyword">var</span> app = <span class="hljs-title function_">getApp</span>();<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> &#123;<br><br>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseRequestUrl</span> = <span class="hljs-title class_">Config</span>.<span class="hljs-property">restUrl</span>;<br>  &#125;<br><br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 封装request请求</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-title function_">request</span>(<span class="hljs-params">params, noRefetch</span>) &#123;<br>    <span class="hljs-keyword">var</span> url = <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseRequestUrl</span> + params.<span class="hljs-property">url</span>;<br>    <span class="hljs-keyword">var</span> that = <span class="hljs-variable language_">this</span>;<br><br>    <span class="hljs-comment">/* 判断请求方式 默认为&#x27;POST&#x27; */</span><br>    <span class="hljs-keyword">if</span> (!params.<span class="hljs-property">type</span>) &#123;<br>      params.<span class="hljs-property">type</span> = <span class="hljs-string">&#x27;POST&#x27;</span>;<br>    &#125;<br><br>    wx.<span class="hljs-title function_">request</span>(&#123;<br>      <span class="hljs-attr">url</span>: url,<br>      <span class="hljs-attr">data</span>: params.<span class="hljs-property">data</span>,<br>      <span class="hljs-attr">header</span>: &#123;<br>        <span class="hljs-string">&#x27;content-type&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>,<br>        <span class="hljs-string">&#x27;token&#x27;</span>: wx.<span class="hljs-title function_">getStorageSync</span>(<span class="hljs-string">&#x27;token&#x27;</span>),<br>      &#125;,<br>      <span class="hljs-attr">method</span>: params.<span class="hljs-property">type</span>,<br>      <span class="hljs-attr">dataType</span>: <span class="hljs-string">&#x27;json&#x27;</span>,<br>      <span class="hljs-attr">responseType</span>: <span class="hljs-string">&#x27;text&#x27;</span>,<br>      <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) &#123;<br>        <span class="hljs-comment">// res.data.param.disable == 1? wx.setStorageSync(&#x27;disable&#x27;, 1): wx.setStorageSync(&#x27;disable&#x27;, 0);</span><br>        <span class="hljs-keyword">var</span> code = res.<span class="hljs-property">statusCode</span>.<span class="hljs-title function_">toString</span>();<br>        <span class="hljs-keyword">var</span> startChar = code.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span> (startChar == <span class="hljs-string">&#x27;2&#x27;</span>) &#123;<br><br>          params.<span class="hljs-property">sCallback</span> &amp;&amp; params.<span class="hljs-title function_">sCallback</span>(res.<span class="hljs-property">data</span>);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>          that.<span class="hljs-title function_">_processError</span>(res);<br>          params.<span class="hljs-property">eCallback</span> &amp;&amp; params.<span class="hljs-title function_">eCallback</span>(res.<span class="hljs-property">data</span>);<br>        &#125;<br>      &#125;,<br>      <span class="hljs-attr">fail</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) &#123;<br><br>        that.<span class="hljs-title function_">_processError</span>(res);<br>      &#125;,<br>    &#125;)<br>  &#125;<br>  <span class="hljs-comment">/**</span><br><span class="hljs-comment">   * 消息提示</span><br><span class="hljs-comment">   */</span><br>  <span class="hljs-title function_">showToast</span>(<span class="hljs-params">title, icon</span>) &#123;<br>    <span class="hljs-keyword">if</span> (!icon) &#123;<br>      icon = <span class="hljs-string">&#x27;none&#x27;</span>;<br>    &#125;<br>    wx.<span class="hljs-title function_">showToast</span>(&#123;<br>      <span class="hljs-attr">title</span>: title,<br>      <span class="hljs-attr">icon</span>: icon,<br>      <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span>,<br>    &#125;)<br>  &#125;<br>  ........<br>&#125;<br><br><span class="hljs-keyword">export</span> &#123;<br>  <span class="hljs-title class_">Base</span><br>&#125;;<br></code></pre></td></tr></table></figure>

</li>
<li><p>public.js </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Home</span><br><span class="hljs-comment"> * 自定义类</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">import</span> &#123;<br>    <span class="hljs-title class_">Base</span><br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../utils/base.js&#x27;</span>;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Public</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Base</span> &#123;<br>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-comment">/* 必须: 调用基类的构造函数 */</span><br>        <span class="hljs-variable language_">super</span>();<br>    &#125;<br>    <span class="hljs-comment">/**获取金牌推荐 */</span><br>    <span class="hljs-title function_">gold_recommend</span>(<span class="hljs-params">data, callback</span>) &#123;<br>        <span class="hljs-keyword">var</span> params = &#123;<br>            <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/gold_list&#x27;</span>,<br>            <span class="hljs-attr">data</span>: data,<br>            <span class="hljs-attr">sCallback</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) &#123;<br>                callback &amp;&amp; <span class="hljs-title function_">callback</span>(res);<br>            &#125;,<br>        &#125;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">request</span>(params);<br>    &#125;<br>   ........<br>&#125;<br><br><span class="hljs-comment">/* 输出类HOME */</span><br><span class="hljs-keyword">export</span> &#123;<br>    <span class="hljs-title class_">Public</span><br>&#125;;<br></code></pre></td></tr></table></figure>

</li>
<li><p>使用 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123;<br>  <span class="hljs-title class_">Public</span><br>&#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../tpls/public.js&#x27;</span>;<br><span class="hljs-keyword">var</span> pub = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Public</span>();<br><span class="hljs-title class_">Page</span>(&#123;<br>    <span class="hljs-title function_">onLoad</span>(<span class="hljs-params"></span>)&#123;<br>        pub.<span class="hljs-title function_">gold_recommend</span>(&#123;<br>            <span class="hljs-string">&#x27;page&#x27;</span>: <span class="hljs-number">1</span>,<br>            <span class="hljs-string">&#x27;limit&#x27;</span>: <span class="hljs-number">5</span><br>        &#125;, <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> &#123;<br>            <span class="hljs-keyword">if</span> (res.<span class="hljs-property">code</span> == <span class="hljs-number">200</span>) &#123;<br>                that.<span class="hljs-title function_">setData</span>(&#123;<br>                    <span class="hljs-title class_">GlodList</span>: res.<span class="hljs-property">data</span><br>                &#125;)<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;)<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="登录模块"><a href="#登录模块" class="headerlink" title="登录模块"></a>登录模块</h2><p>小程序的生命周期 </p>
<ul>
<li><img src="https://img-blog.csdnimg.cn/1be945800a77490089f3acd4baa11683.jpeg#id=m6BIy&originHeight=547&originWidth=1297&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="><br>onReady 生命周期函数–监听页面初次渲染完成<br>onShow 生命周期函数–监听页面显示<br>onHide 生命周期函数–监听页面隐藏<br>onUnload 生命周期函数–监听页面卸载<br>onPullDownRefresh 页面相关事件处理函数–监听用户下拉动作<br>onReachBottom 页面上拉触底事件的处理函数<br>onShareAppMessage 用户点击右上角转发<br>onPageScroll 页面滚动触发事件的处理函数<br>onTabItemTap 当前是 tab 页时，点击 tab 时触发</li>
</ul>
<p>配音圈配音因为是用原生微信小程序进行编写的，没有watch，没有vuex,所以看似很简单的方式就很难实现。就比如进入到小程序里面先进行登录获取头像以及openid,在通过拿到的openid进行身份判断。这里的身份判断要在首页里展示，所以写在首页的onload里，而登录这个东西最早用，并且很多地方用。所以写在小程序的onlaunch函数里。但是因为onlaunch里执行的登录获取openid是个请求，有异步效果。所以在小程序执行完页面的生命周期函数的时候，可能还没有拿到openid。而配音圈配音通过一个回调函数解决了这个问题。<br>总结来说就是微信小程序app.js的onLaunch中的异步请求执行完之后再执行Page的onLoad<br><strong>app.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">App</span>(&#123;<br>  <span class="hljs-attr">globalData</span>: &#123;<br>    <span class="hljs-attr">employ</span>: <span class="hljs-string">&#x27;&#x27;</span>,<br>    <span class="hljs-attr">onLaunchData</span>: <span class="hljs-literal">null</span>,<br>  &#125;,<br>  <span class="hljs-attr">onLaunch</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;onlaunch&quot;</span>);<br>    <span class="hljs-keyword">let</span> that = <span class="hljs-variable language_">this</span>;<br>    wx.<span class="hljs-title function_">request</span>(&#123;<br>      <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;http://101.35.96.100:8001/miniprograms/tideForecast/getAreaList&#x27;</span>,<br>      <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>      <span class="hljs-attr">data</span>: &#123;&#125;,<br>      <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);<br>        <span class="hljs-comment">//设置请求的值</span><br>        that.<span class="hljs-property">globalData</span>.<span class="hljs-property">onLaunchData</span> = res.<span class="hljs-property">data</span>.<span class="hljs-property">data</span><br>        <span class="hljs-comment">//设置请求状态</span><br>        that.<span class="hljs-property">globalData</span>.<span class="hljs-property">employ</span> = <span class="hljs-literal">true</span>;<br>       <span class="hljs-comment">//由于这里是网络请求，可能会在 Page.onLoad 之后才返回  在onLoad中定义下app.employCallback 后才执行下述that.employCallback(true)，此时用户数据肯定得到了，回调内再则可获取到用户数据</span><br>       <span class="hljs-comment">//所以此处加入 callback 以防止这种情况</span><br>        <span class="hljs-keyword">if</span> (that.<span class="hljs-property">employCallback</span>) &#123;<br>          that.<span class="hljs-title function_">employCallback</span>(<span class="hljs-literal">true</span>);<br>        &#125;<br>      &#125;,<br>    &#125;);<br>  &#125;,<br>&#125;)<br></code></pre></td></tr></table></figure>
<p><strong>index.js</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> app = <span class="hljs-title function_">getApp</span>()<br><span class="hljs-title class_">Page</span>(&#123;<br>  <span class="hljs-attr">data</span>: &#123;<br>    <span class="hljs-attr">onLaunchData</span>:<span class="hljs-literal">null</span>,<br>  &#125;,<br>  <span class="hljs-attr">onLoad</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">options</span>) &#123;<br>    <span class="hljs-keyword">let</span> that = <span class="hljs-variable language_">this</span>;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;onload&quot;</span>);<br>    <span class="hljs-keyword">if</span> (app.<span class="hljs-property">globalData</span>.<span class="hljs-property">employ</span> &amp;&amp; app.<span class="hljs-property">globalData</span>.<span class="hljs-property">employ</span> != <span class="hljs-string">&#x27;&#x27;</span>) &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;first&quot;</span>)<br>      <span class="hljs-keyword">let</span> onLaunchData = app.<span class="hljs-property">globalData</span>.<span class="hljs-property">onLaunchData</span>;<br>      that.<span class="hljs-title function_">setData</span>(&#123;<br>        <span class="hljs-attr">onLaunchData</span>: onLaunchData ? onLaunchData : <span class="hljs-literal">null</span><br>      &#125;);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>      <span class="hljs-comment">// 由于 onLaunch里执行的 是网络请求，可能会在 Page.onLoad 之后才返回</span><br>      <span class="hljs-comment">// 所以此处加入 callback 以防止这种情况</span><br>      app.<span class="hljs-property">employCallback</span> = <span class="hljs-function"><span class="hljs-params">employ</span> =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;进入到app.employCallback&quot;</span>);<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(that);<br>        <span class="hljs-keyword">if</span> (employ != <span class="hljs-string">&#x27;&#x27;</span>) &#123;<br>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(employ);<br>          that.<span class="hljs-title function_">setData</span>(&#123;<br>            <span class="hljs-attr">onLaunchData</span>: app.<span class="hljs-property">globalData</span>.<span class="hljs-property">onLaunchData</span><br>          &#125;);         <br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;,<br>&#125;)<br></code></pre></td></tr></table></figure>
<p>这里执行的流程是当微信小程序运行时，首先进入到了onLaunch进行执行，因为onLaunch里面有request是异步请求，所以压力来到了index.js的onload里面，在onload里去判断app.js里的数据状态是什么样的，是true就拿request里的数据，如果没有就对app,js的app对象进行添加一个回调函数属性，在这个回调函数属性里需要传入一个true就能操作index.js的page对象里的data,给onlaunch里请求的值赋值给index.js的page对象里的data。这个时候因为之前在onLaunch写的调用自己的在index.js里写的回调，并传入true,对index.js中data中的数据进行赋值。 </p>
<h2 id="h5上传文件模块"><a href="#h5上传文件模块" class="headerlink" title="h5上传文件模块"></a>h5上传文件模块</h2><p>参考资料<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_37792384/article/details/115952370">Uniapp 内嵌H5跳转内嵌小程序页面</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/rxh13543515695/article/details/124980667">uniapp h5项目点击跳转小程序，h5传参到小程序</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_56712653/article/details/117741481">微信小程序与h5通过web-view传值</a><br><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/community/develop/article/doc/000a0ce2858618976b0a2df3b5bc13">[填坑手册]小程序web-view组件实战与踩坑</a><br>首先因为微信小程序无法打开本地资源管理器。所以都是通过微信的<code>wx.chooseMessageFile</code>进行在本地聊天记录中选取文件。（这种方法也是目前大部分小程序采取上传文件的方式优点是：速度快、兼容性好。缺点：用户需要提前把文件发送给自己聊天列表中的随便一个人）<br><code>wx.chooseMessageFile</code>代码实现 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs javascript">wx.<span class="hljs-title function_">chooseMessageFile</span>(&#123;<br>  <span class="hljs-attr">count</span>: <span class="hljs-number">10</span>,<br>  <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;file&#x27;</span>, <span class="hljs-comment">//	选择了除图片和视频的文件</span><br>  success (res) &#123;<br>    <span class="hljs-comment">// tempFilePath可以作为 img 标签的 src 属性显示图片</span><br>    <span class="hljs-keyword">const</span> tempFilePaths = res.<span class="hljs-property">tempFiles</span><br>  &#125;<br>&#125;)<br></code></pre></td></tr></table></figure>

<p>现在需要直接通过微信小程序去访问本地的资源管理器。我的解决思路的是，通过微信小程序使用webview去调用一个h5页面。在通过h5页面去调用本地资源。选取后将资源上传服务器，在返回到小程序。这里比较困难的是小程序向webview传值以及webview跳回小程序，以及返回参数到小程序。<br>这里首先需要写一个h5的页面进行上传文件,这里需要引入小程序的一个sdk,uniapp使用 <code>npm install --save-dev weixin-js-sdk</code>。然后在main.js里进行全局引入<code>let jweixin = require(&#39;jweixin-module&#39;)</code> <code>Vue.prototype.$wx = jweixin</code>。 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;view class=&quot;content&quot;&gt;<br>    &lt;view class=&quot;add-btn&quot;&gt;<br>      &lt;text class=&quot;text&quot; @click=&quot;openFile&quot;&gt;添加附件&lt;/text&gt;<br>    &lt;/view&gt;<br>  &lt;/view&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>  import wx from &#x27;@/static/activity_sdk.js&#x27;;<br>  export default &#123;<br>    data() &#123;<br>      return &#123;<br>        title: &#x27;Hello&#x27;,<br>        id: &#x27;&#x27;,<br>        token: &#x27;&#x27;<br>      &#125;<br>    &#125;,<br>    methods: &#123;<br>      // 打开文件选择器<br>      openFile() &#123;<br>        let that = this<br>        uni.chooseFile(&#123;<br>          count: 1, //默认100<br>          extension: [&#x27;.mp3&#x27;, &#x27;.m4a&#x27;],<br>          success: (res) =&gt; &#123;<br>            console.log(res);<br>            if (res.tempFiles[0].size / 1024 / 1024 &gt; 20) &#123;<br>              that.$refs.uToast.show(&#123;<br>                title: &#x27;附件大小不能超过20M&#x27;,<br>                type: &#x27;warning&#x27;,<br>              &#125;)<br>              return;<br>            &#125;<br>            var params = &#123;<br>              path: res.tempFilePaths[0],<br>              name: res.tempFiles[0].name,<br>              orderid: 0,<br>            &#125;<br>            that.uploadFile(params);<br>          &#125;<br>        &#125;);<br>      &#125;,<br><br>      uploadFile(params, noRefetch) &#123;<br>        uni.showLoading(&#123;<br>          title: &#x27;上传中...&#x27;,<br>        &#125;);<br>        var that = this;<br>        var url = &#x27;https://dub.wuhanzhuangxiu01.cn/uploadMusic&#x27;;<br>        var name = params.name ? params.name : &#x27;&#x27;;<br>        var key = params.key ? params.key : &#x27;&#x27;;<br>        var ii = params.ii ? params.ii : 0;<br>        var orderid = params.orderid ? params.orderid : 0;<br>        var id = that.id ? that.id : 0;<br>        uni.uploadFile(&#123;<br>          url: url,<br>          filePath: params.path,<br>          fileType: &#x27;audio&#x27;,<br>          name: &#x27;file&#x27;,<br>          header: &#123;<br>            &#x27;token&#x27;: that.token,<br>          &#125;,<br>          formData: &#123;<br>            &#x27;path&#x27;: params.path,<br>            &#x27;name&#x27;: name,<br>            &#x27;key&#x27;: key,<br>            &#x27;ii&#x27;: ii,<br>            &#x27;uid&#x27;: id,<br>            &#x27;orderid&#x27;: orderid<br>          &#125;,<br>          success: function(res) &#123;<br>            var data = JSON.parse(res.data);<br>            uni.hideLoading();<br>            that.$wx.miniProgram.postMessage(&#123;<br>              data: &#123;<br>                name: data,<br>              &#125;<br>            &#125;);<br>            that.$wx.miniProgram.navigateBack(&#123;<br>              delta: 1<br>            &#125;)<br>          &#125;,<br>          fail: function(res) &#123;<br>            console.log(&#x27;fail:&#x27;, res);<br>            uni.hideLoading();<br>            uni.showLoading(&#123;<br>              title: &#x27;上传失败&#x27;,<br>              icon: &#x27;error&#x27;<br>            &#125;);<br>            that.$wx.miniProgram.navigateBack(&#123;<br>              delta: 1<br>            &#125;)<br>          &#125;,<br>        &#125;)<br>      &#125;,<br>    &#125;,<br>    onLoad(e) &#123;<br>      console.log(&#x27;h5页面&#x27;, e);<br>      this.id = e.id<br>      this.token = e.token<br>    &#125;<br>  &#125;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>  .add-btn &#123;<br>    width: 100%;<br>    height: 100vh;<br>    display: flex;<br>    justify-content: center;<br>    align-items: center;<br><br>  &#125;<br><br>  .add-btn text &#123;<br>    display: block;<br>    text-align: center;<br>    line-height: 100rpx;<br>    width: 80%;<br>    height: 100rpx;<br>    background-color: cadetblue;<br>    border-radius: 20rpx;<br>    /* margin: 0 auto; */<br>  &#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<p>这里从webview的网页跳回小程序有个问题。就是只能用<code>navigateBack</code>进行返回。文档上说的是navigateTo、navigateBack、switchTab、reLaunch、redirectTo都能使用，但是在我的环境下只能使用<code>navigateBack</code>进行返回。传值我是通过webview的bindmessage属性进行传值。首先在webview定义好属性写好回调。在h5页面，使用wx.miniProgram.postMessage来进行传值。传的值会在 bindmessage定义好的函数里形参里。<br>因为之前我是使用 <code>navigateBack</code>进行返回的。所以返回的值一直在webview页面。我需要传值给我的返回的这个界面。我在app.js里面定义一个属性进行页面之间的通信。在webview页面接受传回来的值，存放在app.js上面的属性。在跳转的页面进行拿取传过来的值。就能完成从webview传值给微信小程序。<br>微信小程序webview示例代码： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;view class=&quot;content&quot;&gt;<br>    &lt;view class=&quot;add-btn&quot;&gt;<br>      &lt;text class=&quot;text&quot; @click=&quot;openFile&quot;&gt;添加附件&lt;/text&gt;<br>    &lt;/view&gt;<br>  &lt;/view&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>  import wx from &#x27;@/static/activity_sdk.js&#x27;;<br>  export default &#123;<br>    data() &#123;<br>      return &#123;<br>        title: &#x27;Hello&#x27;,<br>        id: &#x27;&#x27;,<br>        token: &#x27;&#x27;<br>      &#125;<br>    &#125;,<br>    methods: &#123;<br>      // 打开文件选择器<br>      openFile() &#123;<br>        let that = this<br>        uni.chooseFile(&#123;<br>          count: 1, //默认100<br>          extension: [&#x27;.mp3&#x27;, &#x27;.m4a&#x27;],<br>          success: (res) =&gt; &#123;<br>            console.log(res);<br>            if (res.tempFiles[0].size / 1024 / 1024 &gt; 20) &#123;<br>              that.$refs.uToast.show(&#123;<br>                title: &#x27;附件大小不能超过20M&#x27;,<br>                type: &#x27;warning&#x27;,<br>              &#125;)<br>              return;<br>            &#125;<br>            var params = &#123;<br>              path: res.tempFilePaths[0],<br>              name: res.tempFiles[0].name,<br>              orderid: 0,<br>            &#125;<br>            that.uploadFile(params);<br>          &#125;<br>        &#125;);<br>      &#125;,<br><br>      uploadFile(params, noRefetch) &#123;<br>        uni.showLoading(&#123;<br>          title: &#x27;上传中...&#x27;,<br>        &#125;);<br>        var that = this;<br>        var url = &#x27;https://dub.wuhanzhuangxiu01.cn/uploadMusic&#x27;;<br>        var name = params.name ? params.name : &#x27;&#x27;;<br>        var key = params.key ? params.key : &#x27;&#x27;;<br>        var ii = params.ii ? params.ii : 0;<br>        var orderid = params.orderid ? params.orderid : 0;<br>        var id = that.id ? that.id : 0;<br>        uni.uploadFile(&#123;<br>          url: url,<br>          filePath: params.path,<br>          fileType: &#x27;audio&#x27;,<br>          name: &#x27;file&#x27;,<br>          header: &#123;<br>            &#x27;token&#x27;: that.token,<br>          &#125;,<br>          formData: &#123;<br>            &#x27;path&#x27;: params.path,<br>            &#x27;name&#x27;: name,<br>            &#x27;key&#x27;: key,<br>            &#x27;ii&#x27;: ii,<br>            &#x27;uid&#x27;: id,<br>            &#x27;orderid&#x27;: orderid<br>          &#125;,<br>          success: function(res) &#123;<br>            var data = JSON.parse(res.data);<br>            uni.hideLoading();<br>            that.$wx.miniProgram.postMessage(&#123;<br>              data: &#123;<br>                name: data,<br>              &#125;<br>            &#125;);<br>            that.$wx.miniProgram.navigateBack(&#123;<br>              delta: 1<br>            &#125;)<br>          &#125;,<br>          fail: function(res) &#123;<br>            console.log(&#x27;fail:&#x27;, res);<br>            uni.hideLoading();<br>            uni.showLoading(&#123;<br>              title: &#x27;上传失败&#x27;,<br>              icon: &#x27;error&#x27;<br>            &#125;);<br>            that.$wx.miniProgram.navigateBack(&#123;<br>              delta: 1<br>            &#125;)<br>          &#125;,<br>        &#125;)<br>      &#125;,<br>    &#125;,<br>    onLoad(e) &#123;<br>      console.log(&#x27;h5页面&#x27;, e);<br>      this.id = e.id<br>      this.token = e.token<br>    &#125;<br>  &#125;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>  .add-btn &#123;<br>    width: 100%;<br>    height: 100vh;<br>    display: flex;<br>    justify-content: center;<br>    align-items: center;<br><br>  &#125;<br><br>  .add-btn text &#123;<br>    display: block;<br>    text-align: center;<br>    line-height: 100rpx;<br>    width: 80%;<br>    height: 100rpx;<br>    background-color: cadetblue;<br>    border-radius: 20rpx;<br>    /* margin: 0 auto; */<br>  &#125;<br>&lt;/style&gt;<br></code></pre></td></tr></table></figure>

<p>这部分代码中的wxml部分，src部分写的很复杂。只有这么写，才能带参数，访问这个h5页面。之前我是先将url合并之后一块给src,但是这个h5会在链接自动生成<code>#</code>在路径里。然后微信这边会自动将#号过滤掉。这个#号是因为路由器的两种工作模式之一的hash模式造成的。    </p>
<p>详解可见 <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37109041/article/details/118962254">Uniapp发布为H5版本时如何隐藏访问路径的#符号</a> </p>
<h2 id="原型与原型链"><a href="#原型与原型链" class="headerlink" title="原型与原型链"></a>原型与原型链</h2><ul>
<li><p><strong>所有函数都有一个特别的属性：</strong><code>**prototype**</code>** : 显式原型属性** </p>
<ul>
<li>每个函数都有一个prototype属性, 它默认指向一个Object空对象 </li>
<li>原型对象中有一个属性constructor, 它指向函数对象<br><img src="https://img-blog.csdnimg.cn/9c55148087e34260b59b490c83f4f8ff.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5qmY5a2Q55qE5b-D6ISP,size_19,color_FFFFFF,t_70,g_se,x_16#id=wMSbE&originHeight=262&originWidth=626&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="> </li>
<li>作用: 函数的所有实例对象自动拥有原型中的属性(方法) <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">//fun的prototype默认指向一个Object空对象</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Fun</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <br><span class="hljs-comment">// 原型对象中有一个属性constructor, 它指向函数对象</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Fun</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> == <span class="hljs-title class_">Fun</span>)<br><br><span class="hljs-title class_">Fun</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">test</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;我是Fun原型上的一个方法&#x27;</span>);<br>&#125;<br><span class="hljs-keyword">let</span> fun = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fun</span>()<br><span class="hljs-comment">// 给原型对象添加的属性 ==&gt; 实例对象可以访问</span><br>fun.<span class="hljs-title function_">test</span>()<br></code></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>所有实例对象都有一个特别的属性:</strong><code>**__proto__**</code>** : 隐式原型属性** </p>
<ul>
<li>对象的隐式原型的值为其对应构造函数的显式原型的值 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Fun</span>(<span class="hljs-params"></span>)&#123;<br><br>&#125;<br><span class="hljs-keyword">let</span> fun = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fun</span>()<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Fun</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> === fun.<span class="hljs-property">__proto__</span>)<br><span class="hljs-comment">// 返回结果是true</span><br></code></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p>在<code>function Fun()&#123;&#125;</code>就相当于在内部 <code>this.prototype = &#123;&#125;</code><br>在<code>let fun = new Fun()</code>就相当于在内部 <code>this.__proto__ = Fn.prototype</code> </p>
<ul>
<li><strong>显示原型与隐式原型在堆和栈上的结构图</strong> <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Fn</span>(<span class="hljs-params"></span>)&#123;&#125;;<br><span class="hljs-keyword">var</span> fn = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fn</span>();<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fn.<span class="hljs-property">__proto__</span>===<span class="hljs-title class_">Fn</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);<br></code></pre></td></tr></table></figure></li>
</ul>
<p><img src="https://img-blog.csdnimg.cn/234a2f3e7aa7427293295b2c04bc6895.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5qmY5a2Q55qE5b-D6ISP,size_20,color_FFFFFF,t_70,g_se,x_16#id=FnOXR&originHeight=574&originWidth=869&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="> </p>
<ul>
<li><strong>原型链</strong><br>所有的实例对象都有<code>__proto__</code>属性, 它指向的就是原型对象。这样通过<code>__proto__</code>属性就形成了一个链的结构—-&gt;原型链 <ol>
<li>当查找对象内部的属性&#x2F;方法时, js引擎自动沿着这个原型链查找 </li>
<li>当给对象属性赋值时不会使用原型链, 而只是在当前对象中进行操作 </li>
<li>别名: 隐式原型链 </li>
<li>作用: 查找对象的属性(方法)</li>
</ol>
</li>
</ul>
<p>代码 </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Fn</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-variable language_">this</span>.<span class="hljs-property">test1</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;test1()&quot;</span>);<br>&#125;<br>&#125;<br><span class="hljs-title class_">Fn</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">test2</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;test2()&quot;</span>)<br>&#125;<br><span class="hljs-keyword">let</span> fn = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fn</span>()<br>fn.<span class="hljs-title function_">test1</span>()<br>fn.<span class="hljs-title function_">test2</span>()<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fn.<span class="hljs-title function_">toString</span>());<br>fn.<span class="hljs-title function_">test3</span>()<br></code></pre></td></tr></table></figure>
<p>图解<img src="https://www.giaott.com/images/2022/08/24/Ovkdd.png#id=eigmY&originHeight=640&originWidth=1144&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="></p>
<ul>
<li><strong>注意：</strong> <ol>
<li><p>函数的显示原型指向的对象默认是空Object实例对象(但Object不满足) </p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Fn</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>) <span class="hljs-comment">// true</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>) <span class="hljs-comment">// false</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>) <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>

</li>
<li><p>所有函数都是Function的实例(包含Function)</p>
</li>
</ol>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Function</span>.<span class="hljs-property">__proto__</span>===<span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)<span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure>
<ol start="3">
<li>Object的原型对象是原型链尽头 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span>) <span class="hljs-comment">// null</span><br></code></pre></td></tr></table></figure></li>
</ol>
<div id="paginator"></div></div><div id="post-footer"><div id="pages"><div class="footer-link" style="width: 50%;text-align:right;border-right:1px #fe2 solid"><a href="/salty.github.io/2022/08/11/%E5%B0%8F%E7%A8%8B%E5%BA%8Fecharts%E5%8A%A8%E6%80%81%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B/">← Next 小程序echarts动态渲染过程</a></div><div class="footer-link" style="width: 50%;right:1px;border-left:1px #fe2 solid"><a href="/salty.github.io/2022/07/20/%E6%8F%92%E5%B1%8F%E5%B9%BF%E5%91%8A%E5%B0%81%E8%A3%85/">插屏广告封装 Prev →</a></div></div></div></div><div class="bottom-btn"><div><a id="to-top" onClick="scrolls.scrolltop();" title="回到顶部" style="opacity: 0; display: none;">∧</a><a id="to-index" href="#toc-div" title="文章目录">≡</a><a id="color-mode" onClick="colorMode.change()" title="切换主题"></a></div></div></article><aside><div id="about"><a href="/salty.github.io/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/">Salty Sun</a></h1><div id="description"><p></p></div></div><div id="aside-block"><div id="toc-div"><h1>目录</h1><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E9%9F%B3%E5%9C%88%E9%85%8D%E9%9F%B3%E7%9A%84%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">配音圈配音的模块化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%A8%A1%E5%9D%97"><span class="toc-number">3.</span> <span class="toc-text">登录模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#h5%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E6%A8%A1%E5%9D%97"><span class="toc-number">4.</span> <span class="toc-text">h5上传文件模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E4%B8%8E%E5%8E%9F%E5%9E%8B%E9%93%BE"><span class="toc-number">5.</span> <span class="toc-text">原型与原型链</span></a></li></ol></div></div><footer><nobr>使用 <a target="_blank" rel="noopener" href="http://hexo.io">Hexo</a></nobr><wbr><nobr> 主题 <a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknights</a></nobr><wbr><nobr>博士 <a target="_blank" rel="noopener" href="https://github.com/SaltySun">SaltySun</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/search.js"></script><script class="pjax-js">reset=_=>{code.findCode();}</script><script src="/salty.github.io/js/arknights.js"></script><script src="/salty.github.io/js/pjax.js"></script><script>window.addEventListener("load",() => {pjax = new Pjax({
 cacheBust: false,
 selectors: ['title','article','#aside-block','.pjax-js'],
 switches: {'article': Pjax.switches.sideBySide},
 switchesOptions: {
   'article': {
     classNames: {
       remove: "pjax-out",
       add: "pjax-in"
     }
   }
 }
});
document.addEventListener("pjax:complete", reset);reset()})</script></body></html>